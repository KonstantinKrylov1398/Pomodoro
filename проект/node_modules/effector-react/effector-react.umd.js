((e,t)=>{'object'==typeof exports&&'undefined'!=typeof module?t(exports,require('react'),require('effector'),require('use-sync-external-store/shim/index.js'),require('use-sync-external-store/shim/with-selector.js')):'function'==typeof define&&define.amd?define(['exports','react','effector','use-sync-external-store/shim/index.js','use-sync-external-store/shim/with-selector.js'],t):t((e='undefined'!=typeof globalThis?globalThis:e||self).effectorReact={},e.React,e.effector,e.useSyncExternalStoreShim,e.useSyncExternalStoreWithSelectorShim)})(this,((e,t,effector,r,n)=>{function u(e){return e&&'object'==typeof e&&'default'in e?e:{default:e}}function a(e,t,r,n){let u=[effector.step.run({fn:e=>t(e)})];if(n&&u.unshift(n),r){let t=effector.createNode({node:u}),n=e.graphite.id,a=r.additionalLinks,o=a[n]||[];return a[n]=o,o.push(t),()=>{let e=o.indexOf(t);-1!==e&&o.splice(e,1),effector.clearNode(t)}}{let t=effector.createNode({node:u,parent:[e],family:{owners:e}});return()=>{effector.clearNode(t)}}}function o(e,t){return t.displayName=e,t}function s(e,t){effector.is.store(e)||m('expect useStore argument to be a store');let n=y.default.useCallback((r=>a(e,r,t)),[e,t]),u=y.default.useCallback((()=>b(e,t)),[e,t]);return r.useSyncExternalStore(n,u,u)}function l([e,t],r){let u,o,s,l,i=h;t?(u=t,s=e,l=[]):({fn:u,store:s,keys:l,defaultValue:o,updateFilter:i=h}=e),effector.is.store(s)||m('useStoreMap expects a store'),Array.isArray(l)||m('useStoreMap expects an array as keys'),'function'!=typeof u&&m('useStoreMap expects a function');let c=y.default.useCallback((e=>a(s,e,r)),[s,r]),f=y.default.useCallback((()=>b(s,r)),[s,r]),d=y.default.useRef(),p=y.default.useRef(),S=y.default.useRef(l);return n.useSyncExternalStoreWithSelector(c,f,f,(e=>{if(d.current!==e||!((e,t)=>{if(!e||!t||e.length!==t.length)return 0;let r=1;for(let n=0;n<e.length;n++)if(e[n]!==t[n]){r=0;break}return r})(S.current,l)){let t=u(e,l);void 0===t&&void 0!==o&&(t=o),d.current=e,S.current=l,void 0!==t&&(p.current=t)}return p.current}),((e,t)=>!i(t,e)))}function i(e){return s(e)}function c(e,t){function r(e){let r=y.default.useRef(e),u=i(n);S((()=>(a({props:r.current,state:n.getState()}),()=>{s({props:r.current,state:n.getState()})})),[]);let o=t(e,u);return r.current=e,o}let n;effector.is.store(e)?n=e:'object'==typeof e&&null!==e?n=effector.combine(e):m('shape should be a store or object with stores');let u='Unknown';n&&n.shortName&&(u=n.shortName);let a=effector.createEvent(),s=effector.createEvent();return r.mounted=a,r.unmounted=s,o(`${u}.View`,r)}function f(e,t){let r=t?e:e[0];(e=>{(e=>{if(!e)throw Error('expect first argument be an object')})(k(e)||(e=>'function'==typeof e)(e))})(r);let n=r.or,u=r.and;if(u){let r=t?u:u[0];if(k(r)&&'and'in r){let r=f(u,t);e=r[0],n={...n,...r[1]}}else e=u}return[e,n]}function d(e,t={}){let r=y.default.useRef({value:null,count:0});S((()=>(e.open(r.current.value),()=>e.close(r.current.value))),[e]),((e,t)=>{if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){let r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return 0;for(let n=0;n<r.length;n++){let u=r[n];if(e[u]!==t[u])return 0}return 1}return 0})(r.current.value,t)||(r.current.value=t,r.current.count+=1),S((()=>{e.set(r.current.value)}),[r.current.count])}function p(e,t){let r,n=t&&(e=>k(e)&&(e.and||e.or))(t[0])?t:[{and:t}],[[u,a],o]=f(n),s={},l={},i=o;return'string'==typeof u?(l={name:u},(e=>k(e)&&'sid'in e)(a)||(s=a||{})):(e=>k(e)&&('domain'in e||'defaultState'in e||'name'in e))(u)&&(l=u,s=u.defaultState||{},r=u.domain),{hook:e,domain:r,defaultState:s,mainConfig:l,maybeConfig:i}}var y=u(t);let m=e=>{throw Error(e)};const b=(e,t)=>t?t.getState(e):e.getState(),h=(e,t)=>e!==t;let S='undefined'!=typeof window?y.default.useLayoutEffect:y.default.useEffect,g=e=>console.error(`${e} is deprecated`),v=e=>t=>{let r=e;return'function'!=typeof e&&(r=t,t=e),o(`Connect(${r.displayName||r.name||'Unknown'})`,(e=>y.default.createElement(r,{...e,...i(t)})))},k=e=>'object'==typeof e&&null!==e,x=(e,t={})=>(k(e)&&(x(e.or,t),((e,t)=>{for(let r in e)t(e[r],r)})(e,((e,r)=>{(e=>void 0===e)(e)||'or'===r||'and'===r||(t[r]=e)})),x(e.and,t)),t);e.connect=v,e.createComponent=c,e.createContextComponent=(e,t,r)=>(g('createContextComponent'),o(`${e.shortName||'Unknown'}.ContextComponent`,(n=>{let u=y.default.useContext(t),a=i(e);return r(n,a,u)}))),e.createGate=(...e)=>(({domain:e,defaultState:t,hook:r,mainConfig:n,maybeConfig:u})=>{function a(e){return r(a,e),null}let s=x({or:u,and:n}),l=`${e?`${e.compositeName.fullName}/`:''}${s.name||'gate'}`,i=effector.createEvent({name:`${l}.set`,sid:s.sid?`${s.sid}|set`:void 0}),c=effector.createEvent({name:`${l}.open`,sid:s.sid?`${s.sid}|open`:void 0}),f=effector.createEvent({name:`${l}.close`,sid:s.sid?`${s.sid}|close`:void 0}),d=effector.createStore(Boolean(0),{name:`${l}.status`,serialize:'ignore'}).on(c,(()=>Boolean(1))).on(f,(()=>Boolean(0))),p=effector.createStore(t,{name:`${l}.state`,sid:s.sid}).on(i,((e,t)=>t)).on(c,((e,t)=>t)).reset(f);if(e){let{hooks:t}=e;effector.launch({target:[t.store,t.store,t.event,t.event,t.event],params:[d,p,c,f,i]})}return a.open=c,a.close=f,a.status=d,a.state=p,a.set=i,o(`Gate:${l}`,a)})(p(d,e)),e.createReactState=(e,t)=>(g('createReactState'),v(t)(e)),e.createStoreConsumer=e=>c(e,(({children:e},t)=>e(t))),e.useEvent=e=>e,e.useGate=d,e.useList=(e,t)=>((e,t,r)=>{let n,u,a,i=[];'object'==typeof t&&null!==t?(t.keys&&(i=t.keys),({fn:n,getKey:u,placeholder:a}=t)):n=t,effector.is.store(e)||m('expect useList first argument to be a store'),'function'!=typeof n&&m("expect useList's renderItem to be a function"),Array.isArray(i)||m("expect useList's keys to be an array");let c=y.default.useMemo((()=>{let t=o(`${e.shortName||'Unknown'}.Item`,(t=>{let{index:n,keys:u,keyVal:a,value:o}=t;if(f.current[1])return f.current[0](o,a);let s=l([{store:e,keys:[n,...u],fn:(e,t)=>e[t[0]]}],r);return f.current[0](s,n)}));return y.default.memo(t)}),[e,r,!!u]),f=y.default.useRef([n,u]);f.current=[n,u];let d=y.default.useMemo((()=>i),i);if(u){let t=s(e,r);return 0===t.length&&a?a:t.map((e=>{let t=f.current[1](e);return y.default.createElement(c,{keyVal:t,key:t,keys:d,value:e})}))}{let t=l([{store:e,keys:[e],fn:e=>e.length}],r);return 0===t&&a?a:Array.from({length:t},((e,t)=>y.default.createElement(c,{index:t,key:t,keys:d})))}})(e,t),e.useStore=i,e.useStoreMap=(e,t)=>l([e,t]),e.useUnit=e=>((e,t)=>{let n=effector.is.unit(e),u=n?{unit:e}:e,o=Array.isArray(u),s=y.default.useRef({stale:1,wasSubscribed:0,justSubscribed:0}),[l,i,c]=y.default.useMemo((()=>{s.current.stale=1;let e=Array.isArray(u)?[]:{},t=[],r=[];for(let n in u){let a=u[n];effector.is.unit(a)||m('expect useUnit argument to be a unit'),effector.is.event(a)||effector.is.effect(a)?e[n]=a:(e[n]=null,t.push(n),r.push(a))}return[e,t,r]}),[s,t,...Object.keys(u),...Object.values(u)]),f=y.default.useRef({value:l,storeKeys:i}),d=y.default.useCallback((e=>{let r=s.current;r.wasSubscribed&&(r.justSubscribed=1);let n=()=>{r.stale||(r.stale=1,e())},u=effector.step.compute({priority:'sampler',batch:1}),o=c.map((e=>a(e,n,t,u)));return r.wasSubscribed=1,()=>{o.forEach((e=>e()))}}),[c,t,f,s]),p=y.default.useCallback((()=>{let e,r=f.current,u=s.current,a=0,d=r.value,p=r.storeKeys;if((i.length>0||p.length>0)&&(u.stale||u.justSubscribed)){a=!u.justSubscribed,e=o?[...l]:{...l},p.length!==i.length&&(a=1);for(let r=0;r<i.length;r++){let n=b(c[r],t),u=i[r];a||(a=p.includes(u)?d[u]!==n:1),e[u]=n}}return a&&(r.value=e),r.storeKeys=i,u.stale=0,u.justSubscribed=0,n?r.value.unit:r.value}),[d,s]);return r.useSyncExternalStore(d,p,p)})(e),Object.defineProperty(e,'__esModule',{value:1})}));
//# sourceMappingURL=effector-react.umd.js.map
