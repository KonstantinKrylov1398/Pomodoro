function e(e,t,r,n){let u=[b.run({fn:e=>t(e)})];if(n&&u.unshift(n),r){let t=h({node:u}),n=e.graphite.id,o=r.additionalLinks,s=o[n]||[];return o[n]=s,s.push(t),()=>{let e=s.indexOf(t);-1!==e&&s.splice(e,1),g(t)}}{let t=h({node:u,parent:[e],family:{owners:e}});return()=>{g(t)}}}function t(e,t){return t.displayName=e,t}function r(t,r){k.store(t)||E('expect useStore argument to be a store');let n=y.useCallback((n=>e(t,n,r)),[t,r]),u=y.useCallback((()=>N(t,r)),[t,r]);return A(n,u,u)}function n([t,r],n){let u,o,s,a,l=M;r?(u=r,s=t,a=[]):({fn:u,store:s,keys:a,defaultValue:o,updateFilter:l=M}=t),k.store(s)||E('useStoreMap expects a store'),Array.isArray(a)||E('useStoreMap expects an array as keys'),'function'!=typeof u&&E('useStoreMap expects a function');let i=y.useCallback((t=>e(s,t,n)),[s,n]),c=y.useCallback((()=>N(s,n)),[s,n]),f=y.useRef(),d=y.useRef(),m=y.useRef(a);return R(i,c,c,(e=>{if(f.current!==e||!((e,t)=>{if(!e||!t||e.length!==t.length)return 0;let r=1;for(let n=0;n<e.length;n++)if(e[n]!==t[n]){r=0;break}return r})(m.current,a)){let t=u(e,a);void 0===t&&void 0!==o&&(t=o),f.current=e,m.current=a,void 0!==t&&(d.current=t)}return d.current}),((e,t)=>!l(t,e)))}function u(e){return e}function o(e){return r(e)}function s(t){return((t,r)=>{let n=k.unit(t),u=n?{unit:t}:t,o=Array.isArray(u),s=y.useRef({stale:1,wasSubscribed:0,justSubscribed:0}),[a,l,i]=y.useMemo((()=>{s.current.stale=1;let e=Array.isArray(u)?[]:{},t=[],r=[];for(let n in u){let o=u[n];k.unit(o)||E('expect useUnit argument to be a unit'),k.event(o)||k.effect(o)?e[n]=o:(e[n]=null,t.push(n),r.push(o))}return[e,t,r]}),[s,r,...Object.keys(u),...Object.values(u)]),c=y.useRef({value:a,storeKeys:l}),f=y.useCallback((t=>{let n=s.current;n.wasSubscribed&&(n.justSubscribed=1);let u=()=>{n.stale||(n.stale=1,t())},o=b.compute({priority:'sampler',batch:1}),a=i.map((t=>e(t,u,r,o)));return n.wasSubscribed=1,()=>{a.forEach((e=>e()))}}),[i,r,c,s]),d=y.useCallback((()=>{let e,t=c.current,u=s.current,f=0,d=t.value,m=t.storeKeys;if((l.length>0||m.length>0)&&(u.stale||u.justSubscribed)){f=!u.justSubscribed,e=o?[...a]:{...a},m.length!==l.length&&(f=1);for(let t=0;t<l.length;t++){let n=N(i[t],r),u=l[t];f||(f=m.includes(u)?d[u]!==n:1),e[u]=n}}return f&&(t.value=e),t.storeKeys=l,u.stale=0,u.justSubscribed=0,n?t.value.unit:t.value}),[f,s]);return A(f,d,d)})(t)}function a(e,t){return n([e,t])}function l(e,u){return((e,u,o)=>{let s,a,l,i=[];'object'==typeof u&&null!==u?(u.keys&&(i=u.keys),({fn:s,getKey:a,placeholder:l}=u)):s=u,k.store(e)||E('expect useList first argument to be a store'),'function'!=typeof s&&E("expect useList's renderItem to be a function"),Array.isArray(i)||E("expect useList's keys to be an array");let c=y.useMemo((()=>{let r=t(`${e.shortName||'Unknown'}.Item`,(t=>{let{index:r,keys:u,keyVal:s,value:a}=t;if(f.current[1])return f.current[0](a,s);let l=n([{store:e,keys:[r,...u],fn:(e,t)=>e[t[0]]}],o);return f.current[0](l,r)}));return y.memo(r)}),[e,o,!!a]),f=y.useRef([s,a]);f.current=[s,a];let d=y.useMemo((()=>i),i);if(a){let t=r(e,o);return 0===t.length&&l?l:t.map((e=>{let t=f.current[1](e);return y.createElement(c,{keyVal:t,key:t,keys:d,value:e})}))}{let t=n([{store:e,keys:[e],fn:e=>e.length}],o);return 0===t&&l?l:Array.from({length:t},((e,t)=>y.createElement(c,{index:t,key:t,keys:d})))}})(e,u)}function i(e,r){function n(e){let t=y.useRef(e),n=o(u);L((()=>(a({props:t.current,state:u.getState()}),()=>{l({props:t.current,state:u.getState()})})),[]);let s=r(e,n);return t.current=e,s}let u;k.store(e)?u=e:'object'==typeof e&&null!==e?u=S(e):E('shape should be a store or object with stores');let s='Unknown';u&&u.shortName&&(s=u.shortName);let a=x(),l=x();return n.mounted=a,n.unmounted=l,t(`${s}.View`,n)}function c(e){return i(e,(({children:e},t)=>e(t)))}function f(e,t){let r=t?e:e[0];var n;(e=>{if(!e)throw Error('expect first argument be an object')})(B(n=r)||(e=>'function'==typeof e)(n));let u=r.or,o=r.and;if(o){let r=t?o:o[0];if(B(r)&&'and'in r){let r=f(o,t);e=r[0],u={...u,...r[1]}}else e=o}return[e,u]}function d(e,t={}){let r=y.useRef({value:null,count:0});L((()=>(e.open(r.current.value),()=>e.close(r.current.value))),[e]),((e,t)=>{if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){let r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return 0;for(let n=0;n<r.length;n++){let u=r[n];if(e[u]!==t[u])return 0}return 1}return 0})(r.current.value,t)||(r.current.value=t,r.current.count+=1),L((()=>{e.set(r.current.value)}),[r.current.count])}function m(e,t){let r=t&&B(n=t[0])&&(n.and||n.or)?t:[{and:t}];var n;let u,[[o,s],a]=f(r),l={},i={},c=a;var d;return'string'==typeof o?(i={name:o},B(d=s)&&'sid'in d||(l=s||{})):(e=>B(e)&&('domain'in e||'defaultState'in e||'name'in e))(o)&&(i=o,l=o.defaultState||{},u=o.domain),{hook:e,domain:u,defaultState:l,mainConfig:i,maybeConfig:c}}function p(...e){return(({domain:e,defaultState:r,hook:n,mainConfig:u,maybeConfig:o})=>{function s(e){return n(s,e),null}let a=I({or:o,and:u}),l=`${e?`${e.compositeName.fullName}/`:''}${a.name||'gate'}`,i=x({name:`${l}.set`,sid:a.sid?`${a.sid}|set`:void 0}),c=x({name:`${l}.open`,sid:a.sid?`${a.sid}|open`:void 0}),f=x({name:`${l}.close`,sid:a.sid?`${a.sid}|close`:void 0}),d=j(Boolean(0),{name:`${l}.status`,serialize:'ignore'}).on(c,(()=>Boolean(1))).on(f,(()=>Boolean(0))),m=j(r,{name:`${l}.state`,sid:a.sid}).on(i,((e,t)=>t)).on(c,((e,t)=>t)).reset(f);if(e){let{hooks:t}=e;$({target:[t.store,t.store,t.event,t.event,t.event],params:[d,m,c,f,i]})}return s.open=c,s.close=f,s.status=d,s.state=m,s.set=i,t(`Gate:${l}`,s)})(m(d,e))}import y from'react';import{step as b,createNode as h,clearNode as g,is as k,scopeBind as v,combine as S,createEvent as x,createStore as j,launch as $}from'effector/effector.mjs';import C from'use-sync-external-store/shim/with-selector.js';import w from'use-sync-external-store/shim/index.js';let E=e=>{throw Error(e)};const{useSyncExternalStore:A}=w,{useSyncExternalStoreWithSelector:R}=C,N=(e,t)=>t?t.getState(e):e.getState(),M=(e,t)=>e!==t;let L='undefined'!=typeof window?y.useLayoutEffect:y.useEffect,O=e=>console.error(`${e} is deprecated`),U=(e,r,n)=>(O('createContextComponent'),t(`${e.shortName||'Unknown'}.ContextComponent`,(t=>{let u=y.useContext(r),s=o(e);return n(t,s,u)}))),K=e=>r=>{let n=e;return'function'!=typeof e&&(n=r,r=e),t(`Connect(${n.displayName||n.name||'Unknown'})`,(e=>y.createElement(n,{...e,...o(r)})))},V=(e,t)=>(O('createReactState'),K(t)(e)),B=e=>'object'==typeof e&&null!==e,I=(e,t={})=>(B(e)&&(I(e.or,t),(e=>{for(let u in e)n=u,(e=>void 0===e)(r=e[u])||'or'===n||'and'===n||(t[n]=r);var r,n})(e),I(e.and,t)),t);export{K as connect,i as createComponent,U as createContextComponent,p as createGate,V as createReactState,c as createStoreConsumer,u as useEvent,d as useGate,l as useList,o as useStore,a as useStoreMap,s as useUnit};
//# sourceMappingURL=effector-react.mjs.map
