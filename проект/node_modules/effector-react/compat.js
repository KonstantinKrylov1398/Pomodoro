'use strict';function e(e){return e&&'object'==typeof e&&'default'in e?e.default:e}function t(e,t,n,r){var u=[v.step.run({fn:function(e){return t(e)}})];if(r&&u.unshift(r),n){var o=v.createNode({node:u}),a=e.graphite.id,s=n.additionalLinks,i=s[a]||[];return s[a]=i,i.push(o),function(){var e=i.indexOf(o);-1!==e&&i.splice(e,1),v.clearNode(o)}}var c=v.createNode({node:u,parent:[e],family:{owners:e}});return function(){v.clearNode(c)}}function n(e,t){return t.displayName=e,t}function r(e,n){v.is.store(e)||y('expect useStore argument to be a store');var r=m.useCallback((function(r){return t(e,r,n)}),[e,n]),u=m.useCallback((function(){return b(e,n)}),[e,n]);return d.useSyncExternalStore(r,u,u)}function u(e,n){var r,u,o,a,s=e[0],i=e[1],c=h;if(i)r=i,o=s,a=[];else{r=s.fn,o=s.store,a=s.keys,u=s.defaultValue;var f=s.updateFilter;c=void 0===f?h:f}v.is.store(o)||y('useStoreMap expects a store'),Array.isArray(a)||y('useStoreMap expects an array as keys'),'function'!=typeof r&&y('useStoreMap expects a function');var l=m.useCallback((function(e){return t(o,e,n)}),[o,n]),d=m.useCallback((function(){return b(o,n)}),[o,n]),g=m.useRef(),x=m.useRef(),S=m.useRef(a);return p.useSyncExternalStoreWithSelector(l,d,d,(function(e){if(g.current!==e||!function(e,t){if(!e||!t||e.length!==t.length)return 0;for(var n=1,r=0;r<e.length;r++)if(e[r]!==t[r]){n=0;break}return n}(S.current,a)){var t=r(e,a);void 0===t&&void 0!==u&&(t=u),g.current=e,S.current=a,void 0!==t&&(x.current=t)}return x.current}),(function(e,t){return!c(t,e)}))}function o(e){return r(e)}function a(e,t){function r(e){var n=m.useRef(e),r=o(u);g((function(){return s({props:n.current,state:u.getState()}),function(){i({props:n.current,state:u.getState()})}}),[]);var a=t(e,r);return n.current=e,a}var u;v.is.store(e)?u=e:'object'==typeof e&&null!==e?u=v.combine(e):y('shape should be a store or object with stores');var a='Unknown';u&&u.shortName&&(a=u.shortName);var s=v.createEvent(),i=v.createEvent();return r.mounted=s,r.unmounted=i,n(a+".View",r)}function s(e,t){var n,r=t?e:e[0];(function(e){if(!e)throw Error('expect first argument be an object')})(k(n=r)||function(e){return'function'==typeof e}(n));var u=r.or,o=r.and;if(o){var a=t?o:o[0];if(k(a)&&'and'in a){var i=s(o,t);e=i[0],u=Object.assign({},u,i[1])}else e=o}return[e,u]}function i(e,t){void 0===t&&(t={});var n=m.useRef({value:null,count:0});g((function(){return e.open(n.current.value),function(){return e.close(n.current.value)}}),[e]),function(e,t){if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return 0;for(var u=0;u<n.length;u++){var o=n[u];if(e[o]!==t[o])return 0}return 1}return 0}(n.current.value,t)||(n.current.value=t,n.current.count+=1),g((function(){e.set(n.current.value)}),[n.current.count])}function c(e){function t(e){return o(t,e),null}var r=e.domain,u=e.defaultState,o=e.hook,a=j({or:e.maybeConfig,and:e.mainConfig}),s=(r?r.compositeName.fullName+"/":'')+(a.name||'gate'),i=v.createEvent({name:s+".set",sid:a.sid?a.sid+"|set":void 0}),c=v.createEvent({name:s+".open",sid:a.sid?a.sid+"|open":void 0}),f=v.createEvent({name:s+".close",sid:a.sid?a.sid+"|close":void 0}),l=v.createStore(Boolean(0),{name:s+".status",serialize:'ignore'}).on(c,(function(){return Boolean(1)})).on(f,(function(){return Boolean(0)})),d=v.createStore(u,{name:s+".state",sid:a.sid}).on(i,(function(e,t){return t})).on(c,(function(e,t){return t})).reset(f);if(r){var p=r.hooks;v.launch({target:[p.store,p.store,p.event,p.event,p.event],params:[l,d,c,f,i]})}return t.open=c,t.close=f,t.status=l,t.state=d,t.set=i,n("Gate:"+s,t)}function f(e,t){var n,r,u,o=s(t&&k(n=t[0])&&(n.and||n.or)?t:[{and:t}]),a=o[0],i=a[0],c=a[1],f={},l={},v=o[1];return'string'==typeof i?(l={name:i},k(u=c)&&'sid'in u||(f=c||{})):function(e){return k(e)&&('domain'in e||'defaultState'in e||'name'in e)}(i)&&(l=i,f=i.defaultState||{},r=i.domain),{hook:e,domain:r,defaultState:f,mainConfig:l,maybeConfig:v}}Object.defineProperty(exports,'__esModule',{value:1});var l=require('react'),v=require('effector/compat'),d=require('use-sync-external-store/shim/index.js'),p=require('use-sync-external-store/shim/with-selector.js'),m=e(l),y=function(e){throw Error(e)},b=function(e,t){return t?t.getState(e):e.getState()},h=function(e,t){return e!==t},g='undefined'!=typeof window?m.useLayoutEffect:m.useEffect,x=function(e){return console.error(e+" is deprecated")},S=function(e){return function(t){var r=e;return'function'!=typeof e&&(r=t,t=e),n("Connect("+(r.displayName||r.name||'Unknown')+")",(function(e){return m.createElement(r,Object.assign({},e,o(t)))}))}},k=function(e){return'object'==typeof e&&null!==e},j=function e(t,n){return void 0===n&&(n={}),k(t)&&(e(t.or,n),function(e){for(var t in e)u=t,function(e){return void 0===e}(r=e[t])||'or'===u||'and'===u||(n[u]=r);var r,u}(t),e(t.and,n)),n};exports.connect=S,exports.createComponent=a,exports.createContextComponent=function(e,t,r){return x('createContextComponent'),n((e.shortName||'Unknown')+".ContextComponent",(function(n){var u=m.useContext(t),a=o(e);return r(n,a,u)}))},exports.createGate=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return c(f(i,t))},exports.createReactState=function(e,t){return x('createReactState'),S(t)(e)},exports.createStoreConsumer=function(e){return a(e,(function(e,t){return(0,e.children)(t)}))},exports.useEvent=function(e){return e},exports.useGate=i,exports.useList=function(e,t){return function(e,t,o){var a,s,i,c=[];'object'==typeof t&&null!==t?(t.keys&&(c=t.keys),a=t.fn,s=t.getKey,i=t.placeholder):a=t,v.is.store(e)||y('expect useList first argument to be a store'),'function'!=typeof a&&y("expect useList's renderItem to be a function"),Array.isArray(c)||y("expect useList's keys to be an array");var f=m.useMemo((function(){var t=n((e.shortName||'Unknown')+".Item",(function(t){var n=t.index,r=t.keys;if(l.current[1])return l.current[0](t.value,t.keyVal);var a=u([{store:e,keys:[n].concat(r),fn:function(e,t){return e[t[0]]}}],o);return l.current[0](a,n)}));return m.memo(t)}),[e,o,!!s]),l=m.useRef([a,s]);l.current=[a,s];var d=m.useMemo((function(){return c}),c);if(s){var p=r(e,o);return 0===p.length&&i?i:p.map((function(e){var t=l.current[1](e);return m.createElement(f,{keyVal:t,key:t,keys:d,value:e})}))}var b=u([{store:e,keys:[e],fn:function(e){return e.length}}],o);return 0===b&&i?i:Array.from({length:b},(function(e,t){return m.createElement(f,{index:t,key:t,keys:d})}))}(e,t)},exports.useStore=o,exports.useStoreMap=function(e,t){return u([e,t])},exports.useUnit=function(e){return function(e,n){var r=v.is.unit(e),u=r?{unit:e}:e,o=Array.isArray(u),a=m.useRef({stale:1,wasSubscribed:0,justSubscribed:0}),s=m.useMemo((function(){a.current.stale=1;var e=Array.isArray(u)?[]:{},t=[],r=[];for(var o in u){var s=u[o];v.is.unit(s)||y('expect useUnit argument to be a unit'),v.is.event(s)||v.is.effect(s)?e[o]=n?v.scopeBind(s,{scope:n}):s:(e[o]=null,t.push(o),r.push(s))}return[e,t,r]}),[a,n].concat(Object.keys(u),Object.values(u))),i=s[0],c=s[1],f=s[2],l=m.useRef({value:i,storeKeys:c}),p=m.useCallback((function(e){var r=a.current;r.wasSubscribed&&(r.justSubscribed=1);var u=function(){r.stale||(r.stale=1,e())},o=v.step.compute({priority:'sampler',batch:1}),s=f.map((function(e){return t(e,u,n,o)}));return r.wasSubscribed=1,function(){s.forEach((function(e){return e()}))}}),[f,n,l,a]),h=m.useCallback((function(){var e,t=l.current,u=a.current,s=0,v=t.value,d=t.storeKeys;if((c.length>0||d.length>0)&&(u.stale||u.justSubscribed)){s=!u.justSubscribed,e=o?[].concat(i):Object.assign({},i),d.length!==c.length&&(s=1);for(var p=0;p<c.length;p++){var m=b(f[p],n),y=c[p];s||(s=d.includes(y)?v[y]!==m:1),e[y]=m}}return s&&(t.value=e),t.storeKeys=c,u.stale=0,u.justSubscribed=0,r?t.value.unit:t.value}),[p,a]);return d.useSyncExternalStore(p,h,h)}(e)};
//# sourceMappingURL=compat.js.map
